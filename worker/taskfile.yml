version: "3"

vars:
  replicas: "{{.replicas | default 1}}"
  apiKey: "{{.apiKey | default .API_KEY}}"
  maxJobs: "{{.maxJobs | default .MAX_JOBS}}"

tasks:
  dev:
    env:
      API_KEY: "{{.apiKey}}"
      MAX_JOBS: "{{.maxJobs}}"
    cmds:
      - |
        for i in $(seq 1 {{.replicas}}); do
          echo "Starting worker $i"
          bun --watch index.ts &
        done
        wait
    silent: false

  install:
    cmds:
      - bun install
  clean:
    cmds:
      - rm -rf ./husky
      - rm -rf ./node_modules
      - rm -rf ./dist

  tools:
    cmds:
      - go install github.com/projectdiscovery/httpx/cmd/httpx@latest
      - go install github.com/projectdiscovery/subfinder/v2/cmd/subfinder@latest
      - go install github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest
      - go install github.com/projectdiscovery/dnsx/cmd/dnsx@latest
      - go install github.com/projectdiscovery/naabu/v2/cmd/naabu@latest
