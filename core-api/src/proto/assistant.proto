syntax = "proto3";

package app;

import "google/protobuf/struct.proto";

// ----------------
// Health Check
// ----------------
service HealthCheck {
  rpc HealthCheck(HealthCheckRequest) returns (HealthCheckResponse);
}

message HealthCheckRequest {}

message HealthCheckResponse {
  string message = 1;
}

// ----------------
// Domain Classify
// ----------------
service DomainClassify {
  rpc DomainClassify(DomainClassifyRequest) returns (DomainClassifyResponse);
}

message DomainClassifyRequest {
  string domain = 1;
}
message DomainClassifyResponse {
  repeated string labels = 1;
}

// ----------------
// Issue bot service
// ----------------
service IssueService {
  rpc ResolveIssueServers(ResolveIssueRequest) returns (ResolveIssueResponse);
}

enum IssueType {
  ISSUE_TYPE_UNSPECIFIED = 0;
  ISSUE_TYPE_SSL = 1;
  ISSUE_TYPE_VULNERABILITY = 2;
}

message ResolveIssueRequest {
  string question = 1;
  IssueType issue_type = 2;
  google.protobuf.Struct metadata = 3;
}

message ResolveIssueResponse {
  string message = 1;
}

// ----------------
// Nuclei template gen 
// ----------------
service NucleiTemplateService {
  rpc CreateTemplate(CreateTemplateRequest) returns (CreateTemplateResponse);
}
message CreateTemplateRequest {
  string question = 1;
}
message CreateTemplateResponse {
  string answer = 1;
}

// ----------------
// Conversation
// ----------------
service ConversationService {
  rpc GetConversations(GetConversationsRequest) returns (GetConversationsResponse);
  rpc UpdateConversation(UpdateConversationRequest) returns (UpdateConversationResponse);
  rpc DeleteConversation(DeleteConversationRequest) returns (DeleteConversationResponse);
  rpc DeleteConversations(DeleteConversationsRequest) returns (DeleteConversationsResponse);
}

message Conversation {
  string conversation_id = 1;
  string title = 2;
  string description = 3;
  string created_at = 4;
  string updated_at = 5;
}

message GetConversationsRequest {
}

message GetConversationsResponse {
  repeated Conversation conversations = 1;
}

message UpdateConversationRequest {
  string conversation_id = 1;
  string title = 2;
  string description = 3;
}

message UpdateConversationResponse {
  Conversation conversation = 1;
}

message DeleteConversationRequest {
  string conversation_id = 1;
}

message DeleteConversationResponse {
  string message = 1;
  bool success = 2;
}

message DeleteConversationsRequest {
}

message DeleteConversationsResponse {
  string message = 1;
  bool success = 2;
}

// ----------------
// Message
// ----------------
service MessageService {
  rpc GetMessages(GetMessagesRequest) returns (GetMessagesResponse);
  rpc CreateMessage(CreateMessageRequest) returns (stream CreateMessageResponse);
  rpc UpdateMessage(UpdateMessageRequest) returns (stream UpdateMessageResponse);
  rpc DeleteMessage(DeleteMessageRequest) returns (DeleteMessageResponse);
}

message Message {
  string message_id = 1;
  string question = 2;
  // type = ["message_start","delta","message_end","thinking","tool_start",
  // "tool_output","tool_end","state","error","done","system","event"]
  string type = 3;
  string content = 4;  // JSON string containing message-specific data
  string conversation_id = 5;
  string created_at = 6;
  string updated_at = 7;
}

message GetMessagesRequest {
  string conversation_id = 1;
}

message GetMessagesResponse {
  repeated Message messages = 1;
}

message CreateMessageRequest {
  string question = 1;
  string conversation_id = 2;
  bool is_create_conversation = 3;
}

message CreateMessageResponse {
  Message message = 1;
  Conversation conversation = 2;
}

message UpdateMessageRequest {
  string conversation_id = 1;
  string message_id = 2;
  string question = 3;
}

message UpdateMessageResponse {
  Message message = 1;
}

message DeleteMessageRequest {
  string conversation_id = 1;
  string message_id = 2;
}

message DeleteMessageResponse {
  string message = 1;
  bool success = 2;
}

// ----------------
// MCP Server
// ----------------
service MCPServerService {
  rpc GetMCPServers(GetMCPServersRequest) returns (GetMCPServersResponse);
  rpc AddMCPServers(AddMCPServersRequest) returns (AddMCPServersResponse);
  rpc UpdateMCPServers(UpdateMCPServersRequest) returns (UpdateMCPServersResponse);
  rpc DeleteMCPServers(DeleteMCPServersRequest) returns (DeleteMCPServersResponse);
  rpc GetMCPServerHealth(GetMCPServerHealthRequest) returns (GetMCPServerHealthResponse);
}

message MCPServer {
  google.protobuf.Struct config = 1;  // Server config (url/command, args, env, headers, disabled, etc.)
  oneof status {
    bool active = 2;      // true if server is connected and operational
    string error = 3;     // error message if connection failed or server disabled
  }
}

// Get all servers for workspace/user
message GetMCPServersRequest {
}

message GetMCPServersResponse {
  repeated MCPServer servers = 1;
  string mcp_config_json = 2;  // JSON string of config with status embedded in each server
}

// Add servers - fails if exists
message AddMCPServersRequest {
  google.protobuf.Struct mcp_config = 1;
}

message AddMCPServersResponse {
  repeated MCPServer servers = 1;
  bool success = 2;
  string error = 3;
  string mcp_config_json = 4;  // JSON string of config with metadata and status
}

// Update/Upsert servers - creates if not exists, updates if exists
message UpdateMCPServersRequest {
  google.protobuf.Struct mcp_config = 1;  // Claude Desktop format: {"mcpServers": {"name": {...}}}
}

message UpdateMCPServersResponse {
  repeated MCPServer servers = 1;
  bool success = 2;
  string mcp_config_json = 3;  // JSON string of config with metadata and status
}

// Delete MCP servers by config ID
message DeleteMCPServersRequest {
  string id = 1;  // MCP Config ID (UUID)
}

message DeleteMCPServersResponse {
  bool success = 1;
  string message = 2;
}

// Health check for a specific MCP server
message GetMCPServerHealthRequest {
  string server_name = 1;  // Name of the server to check
}

message GetMCPServerHealthResponse {
  bool is_active = 1;      // true if server is connected and operational
  string status = 2;       // "active", "disabled", or "error"
  string error = 3;        // error message if status is "error"
}

